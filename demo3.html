<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>伴学鸭聊天记录</title>
    <style>
        /* 全局样式 */
        body {
            font-family: "PingFang SC", -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(to bottom right, #CCFF88, #F1FFD7);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .phone-container {
            width: 375px;
            height: 812px;
            background: linear-gradient(150deg, #ccff88 0%, #f1ffd7 100%);
            border-radius: 33px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .chat-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 88px; /* 为底部功能区留出空间 */
            padding: 60px 15px 15px; /* 顶部padding增加到60px，给状态栏留足空间 */
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            -webkit-overflow-scrolling: touch;
            mask-image: linear-gradient(to bottom, transparent 0, transparent 44px, black 60px); /* 创建顶部透明遮罩 */
            -webkit-mask-image: linear-gradient(to bottom, transparent 0, transparent 44px, black 60px);
        }

        /* 顶部状态栏 */
        .status-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            z-index: 10; /* 提高z-index确保始终在最上层 */
            background-color: rgba(204, 255, 136, 0.9); /* 半透明背景 */
            backdrop-filter: blur(5px); /* 添加模糊效果 */
            -webkit-backdrop-filter: blur(5px);
        }

        .status-bar-time {
            color: #333;
            font-weight: 600;
            font-size: 14px;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        }

        .status-bar-icons {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .status-bar-icon {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .status-bar-icon svg {
            width: auto;
            height: auto;
        }

        /* 底部功能区 - 更新样式 */
        .bottom-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 88px;
            background: white;  /* 纯白色背景，与设计图一致 */
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 9;
            padding-bottom: 14px;  /* 添加底部间距，为小横条留出空间 */
        }

        .bottom-bar-icon {
            width: 28px;
            height: 28px;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .bottom-bar-icon:hover {
            background-color: rgba(204, 255, 136, 0.3);
        }

        /* 修改鸭子图标样式，使其与设计图一致 */
        .duck-icon {
            width: 58px;
            height: 58px;
            background-color: #51AE67;  /* 绿色背景，与设计图一致 */
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 8px rgba(81, 174, 103, 0.3);
            margin-bottom: 5px;  /* 调整底部间距 */
        }

        /* 添加底部小横条 */
        .bottom-bar-indicator {
            position: absolute;
            bottom: 9px;
            left: 50%;
            transform: translateX(-50%);
            width: 134px;
            height: 5px;
            background-color: black;
            border-radius: 2.5px;
        }

        /* 消息样式 */
        .message {
            max-width: 80%;
            margin-bottom: 18px;
            position: relative;
            animation: fadeIn 0.3s ease forwards;
            padding: 14px 20px;
            border-radius: 18px;
            font-size: 16px;
            line-height: 1.4;
            word-break: break-word;
        }

        .duck-message {
            align-self: flex-start;
            background-color: rgba(255, 255, 255, 0.8);
            color: #333;
            border-radius: 18px 18px 18px 0;
            margin-left: 0;
            border: 1px solid rgba(195, 225, 149, 0.5);
            box-shadow: 0 2px 8px rgba(195, 225, 149, 0.25);
        }

        .duck-message::before {
            content: "";
            position: absolute;
            bottom: 0;
            left: -10px;
            width: 20px;
            height: 20px;
            background-color: rgba(255, 255, 255, 0.8);
            border-bottom-right-radius: 20px;
            z-index: -1;
        }

        .duck-message::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: -10px;
            width: 20px;
            height: 20px;
            background-color: rgba(255, 255, 255, 0);
            border-bottom-right-radius: 20px;
            box-shadow: 5px 0 0 0 rgba(255, 255, 255, 0.8);
            z-index: -2;
        }

        .user-message {
            align-self: flex-end;
            background-color: rgba(255, 255, 255, 0.4);
            color: #585858;
            border-radius: 20px;
            margin-right: 0;
            box-shadow: 0 2px 8px rgba(81, 174, 103, 0.25);
        }

        .user-message::before {
            content: "";
            position: absolute;
            bottom: 0;
            right: -10px;
            width: 20px;
            height: 20px;
            background-color: rgba(81, 174, 103, 0.9);
            border-bottom-left-radius: 20px;
            z-index: -1;
        }

        .user-message::after {
            content: "";
            position: absolute;
            bottom: 0;
            right: -10px;
            width: 20px;
            height: 20px;
            background-color: rgba(81, 174, 103, 0);
            border-bottom-left-radius: 20px;
            box-shadow: -5px 0 0 0 rgba(81, 174, 103, 0.9);
            z-index: -2;
        }

        .duck-avatar {
            width: 40px;
            height: 40px;
            background-color: #FFDB70;
            border-radius: 50%;
            position: absolute;
            left: -50px;
            top: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            box-shadow: 0 2px 8px rgba(255, 219, 112, 0.3);
        }

        /* 灵动岛样式 - 保持原样 */
        .dynamic-island {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(1, 1, 1, 0.8);
            border-radius: 37px;
            z-index: 100;
            transition: all 0.5s cubic-bezier(0.33, 1, 0.68, 1); /* 使用更平滑的缓动函数 */
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            padding: 0;
            width: 134px;
            min-height: 36px;
            backdrop-filter: blur(10.7px);
            -webkit-backdrop-filter: blur(10.7px);
            will-change: width, height, min-height; /* 提示浏览器预先做好准备 */
        }

        .dynamic-island.expanded-step1 {
            width: 347px;
            height: 68px;
        }

        .dynamic-island.expanded-step2 {
            width: 347px;
            height: 182px;
        }

        .dynamic-island.expanded-step3 {
            width: 347px;
            min-height: 282px;
            height: auto;
            max-height: 500px;
        }

        .eye-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            animation: lookAround 8s ease-in-out infinite;
            transition: opacity 0.5s ease;
            opacity: 1;
            padding-top: 8px;
            width: 100%;
        }

        .eye-container.fade-out {
            opacity: 0;
        }

        .eye-container.hidden {
            display: none;
        }

        .eye {
            width: 18px;
            height: 22px;
            background-color: #6ef089;
            border-radius: 50% / 40%;
            transition: height 0.2s ease;
        }

        .eye.blink {
            animation: blinkAnim 0.3s ease-in-out forwards;
        }

        @keyframes blinkAnim {
            0% { height: 22px; }
            50% { height: 4px; }
            100% { height: 22px; }
        }

        @keyframes lookAround {
            0% { transform: translateX(0); }
            20% { transform: translateX(8px); }
            40% { transform: translateX(-8px); }
            60% { transform: translateX(0); }
            100% { transform: translateX(0); }
        }

        .thinking-text {
            position: absolute;
            left: 24px;
            top: 26px;
            font-family: 'PingFang SC', sans-serif;
            font-size: 16px;
            line-height: 18px;
            letter-spacing: 0.08em;
            color: #94FAA1;
            opacity: 0;
            transition: opacity 0.5s ease;
            white-space: nowrap;
        }

        .thinking-text.visible {
            opacity: 1;
        }

        .think-icon {
            position: absolute;
            left: 24px;
            top: 62px;
            width: 12px;
            height: 9px;
            z-index: 12;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .think-icon.visible {
            opacity: 1;
        }

        .analysis-text {
            position: absolute;
            left: 42px;
            right: 29px;
            top: 56px;
            font-family: 'PingFang SC', sans-serif;
            font-size: 14px;
            font-weight: normal;
            line-height: 20px;
            letter-spacing: 0.1em;
            color: #94FAA1;
            opacity: 0;
            transition: opacity 0.5s ease;
            text-align: justify;
            text-justify: inter-word;
            max-width: 276px;
        }

        .analysis-text.visible {
            opacity: 0.8;
        }

        .find-icon {
            position: absolute;
            left: 24px;
            width: 12px;
            height: 12px;
            z-index: 12;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .find-icon.visible {
            opacity: 1;
        }

        .extra-text {
            position: absolute;
            font-family: 'PingFang SC', sans-serif;
            font-size: 12px;
            font-weight: normal;
            line-height: 20px;
            color: rgba(111, 255, 243, 0.7);
            background-color: rgba(148, 250, 161, 0.2);
            padding: 4px 14px;
            white-space: normal;
            border-radius: 20px;
            opacity: 0;
            transition: opacity 0.5s ease;
            max-width: 260px;
            right: 29px;
        }

        .extra-text.visible {
            opacity: 1;
        }

        /* 选项样式 */
        .options-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px 0;
            animation: fadeIn 0.3s ease forwards;
        }

        .option-button {
            width: 90%;
            padding: 15px 0;
            margin-bottom: 10px;
            border-radius: 18px;
            font-size: 16px;
            text-align: center;
            background-color: rgba(255, 255, 255, 0.4);
            color: #333;
            box-shadow: 0 2px 10px rgba(195, 225, 149, 0.3);
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .option-button:hover, .option-button.selected {
            background-color: #51AE67;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(81, 174, 103, 0.3);
        }

        /* 表单样式 */
        .form-container {
            width: 90%;
            margin: 15px auto;
            background-color: rgba(255, 255, 255, 0.4);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 4px 25px rgba(195, 225, 149, 0.2);
            animation: fadeIn 0.3s ease forwards;
        }

        .form-title {
            color: #469337;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group-title {
            font-size: 16px;
            font-weight: 500;
            color: #333;
            margin-bottom: 12px;
        }

        .form-options {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        .form-option {
            flex: 1 0 30%;
            background-color: #E6FEC5;
            color: #333;
            padding: 12px 0;
            margin: 5px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(70, 147, 55, 0.1);
        }

        .form-option:hover, .form-option.selected {
            background-color: #51AE67;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(81, 174, 103, 0.2);
        }

        .form-submit {
            background-color: #51AE67;
            color: white;
            border: none;
            border-radius: 14px;
            padding: 15px 0;
            width: 100%;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            margin-top: 15px;
            box-shadow: 0 4px 15px rgba(81, 174, 103, 0.2);
            transition: all 0.3s ease;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .form-submit:hover {
            background-color: #469337;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(81, 174, 103, 0.3);
        }

        /* 图表和卡片样式 */
        .card-container {
            width: 90%;
            margin: 15px auto;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(195, 225, 149, 0.25);
            animation: fadeIn 0.3s ease forwards;
        }

        .card-title {
            color: #469337;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }

        .chart-container {
            height: 300px;
            overflow-y: auto;
            padding: 5px;
        }

        .statistics-bar {
            height: 30px;
            background-color: #51AE67;
            border-radius: 6px;
            margin: 8px 0;
            display: flex;
            align-items: center;
            padding: 0 15px;
            color: white;
            font-weight: 500;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(81, 174, 103, 0.2);
        }

        .video-list, .exercise-list {
            margin-top: 15px;
        }

        .video-item, .exercise-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-radius: 15px;
            background-color: white;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .video-item:hover, .exercise-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .video-icon, .exercise-icon {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 15px;
            color: white;
            font-size: 20px;
        }
        
        .video-icon {
            background-color: #DC74E9;
            box-shadow: 0 2px 8px rgba(220, 116, 233, 0.3);
        }
        
        .exercise-icon {
            background-color: #2A95E7;
            box-shadow: 0 2px 8px rgba(42, 149, 231, 0.3);
        }

        .video-info, .exercise-info {
            flex: 1;
        }

        .video-title, .exercise-title {
            font-weight: 500;
            color: #333;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .video-duration, .exercise-duration {
            font-size: 14px;
            color: #868686;
        }

        .check-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: rgba(84, 202, 21, 0.2);
            display: flex;
            justify-content: center;
            align-items: center;
            color: #54CA15;
            font-size: 16px;
        }

        /* 计划卡片样式 */
        .plan-card {
            margin-top: 15px;
        }

        .plan-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-radius: 15px;
            background-color: white;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .plan-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .plan-icon {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 15px;
            font-size: 22px;
            background-color: #E6FEC5;
            color: #51AE67;
        }

        .plan-info {
            flex: 1;
        }

        .plan-title {
            font-weight: 500;
            color: #333;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .plan-duration {
            font-size: 14px;
            color: #868686;
        }

        .plan-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .plan-button {
            width: 48%;
            padding: 14px 0;
            border-radius: 14px;
            font-size: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .plan-button-adjust {
            background-color: white;
            color: #585858;
            border: 1px solid #EAEAEA;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .plan-button-adjust:hover {
            background-color: #f8f8f8;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .plan-button-add {
            background-color: #51AE67;
            color: white;
            border: none;
            box-shadow: 0 2px 10px rgba(81, 174, 103, 0.2);
        }

        .plan-button-add:hover {
            background-color: #469337;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(81, 174, 103, 0.3);
        }

        .success-dialog {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 4px 25px rgba(0, 0, 0, 0.15);
            text-align: center;
            z-index: 1000;
            width: 250px;
        }

        .success-message {
            font-weight: 500;
            margin-bottom: 20px;
            font-size: 18px;
            color: #333;
        }

        .success-button {
            background-color: #51AE67;
            color: white;
            border: none;
            border-radius: 14px;
            padding: 12px 30px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            box-shadow: 0 4px 10px rgba(81, 174, 103, 0.2);
            transition: all 0.3s ease;
        }

        .success-button:hover {
            background-color: #469337;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(81, 174, 103, 0.3);
        }

        /* 动画效果 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* 移除所有消息气泡尾部 */
        .user-message::before, 
        .user-message::after,
        .duck-message::before,
        .duck-message::after {
            display: none !important;
        }

        /* 移除用户消息气泡尾部 */
        .user-message::before, 
        .user-message::after {
            display: none !important;
        }

        /* 添加一个顶部遮罩，确保内容不会显示在状态栏下方 */
        .phone-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 44px;
            background: linear-gradient(150deg, #ccff88 0%, #f1ffd7 100%);
            z-index: 9;
            pointer-events: none; /* 允许点击穿透 */
        }

        .form-option.hover-effect {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(81, 174, 103, 0.2);
            background-color: rgba(81, 174, 103, 0.2);
        }
        
        .form-submit.clicked {
            transform: translateY(2px);
            box-shadow: 0 2px 5px rgba(81, 174, 103, 0.2);
        }
    </style>
</head>
<body>
    <div class="phone-container">
        <!-- 灵动岛 - 保持原有实现 -->
        <div class="dynamic-island" id="dynamic-island">
            <div class="eye-container" id="eye-container">
                <div class="eye" id="left-eye"></div>
                <div class="eye" id="right-eye"></div>
            </div>
            <div class="thinking-text" id="thinking-text">思考中</div>
            <img src="think icon.png" alt="思考" id="think-icon" class="think-icon">
            <div class="analysis-text" id="analysis-text"></div>
            <img src="find.png" alt="搜索" id="find-icon" class="find-icon">
            <div class="extra-text" id="extra-line1"></div>
            <div class="extra-text" id="extra-line2"></div>
        </div>

        <!-- 状态栏 -->
        <div class="status-bar">
            <div class="status-bar-time">10:41</div>
            <div class="status-bar-icons">
                <!-- 信号强度图标 -->
                <div class="status-bar-icon">
                    <svg width="16" height="10" viewBox="0 0 16 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M304 20H305C305.552 20 306 20.4477 306 21V27C306 27.5523 305.552 28 305 28H304C303.448 28 303 27.5523 303 27V21C303 20.4477 303.448 20 304 20Z" transform="translate(-294 -18)" fill="#333333"/>
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M299.5 22H300.5C301.052 22 301.5 22.4477 301.5 23V27C301.5 27.5523 301.052 28 300.5 28H299.5C298.948 28 298.5 27.5523 298.5 27V23C298.5 22.4477 298.948 22 299.5 22Z" transform="translate(-294 -18)" fill="#333333"/>
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M295 23.5H296C296.552 23.5 297 23.9477 297 24.5V27C297 27.5523 296.552 28 296 28H295C294.448 28 294 27.5523 294 27V24.5C294 23.9477 294.448 23.5 295 23.5Z" transform="translate(-294 -18)" fill="#333333"/>
                    </svg>
                </div>
                
                <!-- WiFi图标 -->
                <div class="status-bar-icon">
                    <svg width="16" height="12" viewBox="0 0 16 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M324.132 24.9395C324.771 24.9395 325.393 25.1075 325.94 25.4279L326.162 25.5577C326.33 25.6562 326.36 25.8865 326.222 26.024L324.328 27.9129C324.212 28.0289 324.023 28.0289 323.907 27.9129L322.025 26.0362C321.887 25.8993 321.916 25.6701 322.083 25.5709L322.302 25.4405C322.855 25.112 323.484 24.9395 324.132 24.9395Z" transform="translate(-316 -18)" fill="#333333"/>
                        <path d="M324.133 21.4707C325.724 21.4707 327.251 21.9984 328.495 22.9758L328.671 23.1139C328.811 23.224 328.824 23.4315 328.697 23.5573L327.567 24.685C327.462 24.7893 327.297 24.8013 327.178 24.7131L327.04 24.6107C326.2 23.9861 325.186 23.6511 324.133 23.6511C323.073 23.6511 322.053 23.9903 321.21 24.622L321.072 24.7254C320.953 24.8142 320.787 24.8025 320.682 24.6979L319.552 23.5707C319.426 23.4451 319.438 23.2382 319.578 23.1279L319.753 22.9896C321 22.0036 322.534 21.4707 324.133 21.4707Z" transform="translate(-316 -18)" fill="#333333"/>
                        <path d="M324.133 18C326.657 18 329.072 18.8906 330.983 20.5229L331.146 20.6623C331.278 20.7749 331.285 20.9756 331.163 21.098L330.036 22.2219C329.926 22.3308 329.752 22.3385 329.634 22.2395L329.494 22.1228C327.989 20.8647 326.104 20.1804 324.133 20.1804C322.155 20.1804 320.263 20.8694 318.756 22.1354L318.617 22.2527C318.498 22.3521 318.324 22.3447 318.214 22.2356L317.087 21.1118C316.965 20.9895 316.972 20.7892 317.104 20.6765L317.266 20.5371C319.18 18.8959 321.601 18 324.133 18Z" transform="translate(-316 -18)" fill="#333333"/>
                    </svg>
                </div>
                
                <!-- 电池图标 -->
                <div class="status-bar-icon">
                    <svg width="25" height="12" viewBox="0 0 25 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M360 21V21C360.552 21 361 21.4477 361 22V24C361 24.5523 360.552 25 360 25V25V21Z" transform="translate(-336 -17)" fill="#333333" fill-opacity="0.6"/>
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M339 17H356C357.657 17 359 18.3431 359 20V26C359 27.6569 357.657 29 356 29H339C337.343 29 336 27.6569 336 26V20C336 18.3431 337.343 17 339 17ZM339 18C337.895 18 337 18.8954 337 20V26C337 27.1046 337.895 28 339 28H356C357.105 28 358 27.1046 358 26V20C358 18.8954 357.105 18 356 18H339Z" transform="translate(-336 -17)" fill="#333333" fill-opacity="0.6"/>
                        <rect x="2" y="2" width="19" height="8" rx="1" fill="#333333"/>
                    </svg>
                </div>
            </div>
        </div>

        <!-- 聊天容器 -->
        <div class="chat-container" id="chat-messages-container"></div>

        <!-- 底部功能区 -->
        <div class="bottom-bar">
            <div class="bottom-bar-icon">
                <img src="task01.png" alt="计划" style="width: 26px; height: 26px;">
            </div>
            <div class="duck-icon">
                <img src="duck.png" alt="鸭子" style="width: 40px; height: 40px;">
            </div>
            <div class="bottom-bar-icon">
                <img src="my.png" alt="我的" style="width: 26px; height: 26px;">
            </div>
            <!-- 添加底部小横条 -->
            <div class="bottom-bar-indicator"></div>
        </div>
    </div>

    <script>
        // 对话内容数组
        const conversation = [
            {
                type: 'user',
                content: '有道题不会',  // 空内容，只显示图片
                image: '题目一.png'  // 首先显示题目
            },
            {
                type: 'user',
                content: '这题想了半天，没思路。'  // 学生看到题目后的回应
            },
            {
                type: 'thinking',
                analysis: '使用苏格拉底提问法迫使学生反思思维漏洞。若学生能清晰描述卡点（如"公式记混"），则针对性补充知识点；若回答模糊（如"全不会"），则需拆解问题层级。',
                searching: '检索《学生错题归因话术库》'
            },
            {
                type: 'ai',
                content: '你是卡在哪儿了？'
            },
            {
                type: 'user',
                content: '我忘了什么情况下他没有感应电流了。'
            },
            {
                type: 'thinking',
                analysis: '试探学生知识残留度：\n若回答"记得"，则追问具体内容以验证真实性；\n若回答"忘了"，则直接输出结论性知识，避免纠缠术语。\n此处预设学生基础薄弱，需用最小知识单元解决问题。',
                searching: '查询《学情档案库》'
            },
            {
                type: 'ai',
                content: '你还记得楞次定律不？'
            },
            {
                type: 'user',
                content: '忘了。。。'
            },
            {
                type: 'thinking',
                analysis: '学生明确暴露知识漏洞（感应电流产生条件），需判断其底层概念掌握情况：\n是否理解"磁通量变化"本质（面积变化/磁场变化/夹角变化）；\n是否混淆"电动势"与"电流"条件（闭合回路是否为必要前提）。\n优先用生活化比喻解释抽象概念。',
                searching: '从《必考结论速记库》提取"感应电流产生条件"一句话口诀："磁通变，电流现；磁通稳，电流没。"'
            },
            {
                type: 'ai',
                content: '你就记住线圈靠近磁场时，穿过线圈的磁通量会逐渐增加，这时就会引起电流。磁通量不变化时，就没有电流。'
            },
            {
                type: 'user',
                content: '哦哦懂了'
            },
            {
                type: 'ai',
                content: '那这题选啥'
            },
            {
                type: 'user',
                content: '选C'
            },
            {
                type: 'thinking',
                analysis: '通过变式训练检测知识迁移能力：\n同条件不同情境（如线圈远离磁场）；\n同情境不同条件（如磁场强度随时间变化）。\n巩固学生对"磁通量变化"本质的理解。',
                searching: '从《变式题自动生成器》提取参数修改后的新题（如改变线圈运动方向或磁场类型）。'
            },
            {
                type: 'ai',
                content: '对了，再给你出道类似的题吧，这题你选什么？',
                image: '习题三.png'  // 添加习题三图片
            },
            {
                type: 'user',
                content: '选A'
            },
            {
                type: 'thinking',
                analysis: '完成单题闭环：\n正向反馈：强化学生自我效能感；\n错题管理：将原题加入复习计划，利用间隔重复规律对抗遗忘曲线；\n预设监督：暗示"改天考你"，增加后续练习承诺感。',
                searching: '调用《艾宾浩斯复习计划模板》，将此题插入10天后的"电磁感应专题复习"。'
            },
            {
                type: 'ai',
                content: '不错呀，你悟性还挺好，前边那道题我已经给你添加到错题本了，放在后续的练习计划中了，改天考你',
                image: '错题回顾.svg'
            },
            {
                type: 'thinking',
                analysis: '学生主动说明情况，需优先支持而非指责。调整计划时保持弹性，避免增加焦虑。自动延期功能传递"计划可调整，但目标不变"的态度，维护学生自主感。',
                searching: '启动《动态计划调整算法》，根据考试日期延后任务并重新计算每日任务量，避免任务堆积。'
            },
            {
                type: 'user',
                content: '对了，我后天有考试，练不了了。'
            },
            {
                type: 'ai',
                content: '好，我给你调整下。',
                image: '修改计划.svg'
            }
        ];

        // 创建消息元素的函数
        function createElement(className, innerHTML = '') {
            const element = document.createElement('div');
            element.className = className;
            element.innerHTML = innerHTML;
            return element;
        }

        // 显示AI消息
        async function showAiMessage(message) {
            return new Promise(resolve => {
                setTimeout(() => {
                    const container = document.getElementById('chat-messages-container');
                    const messageElement = createElement('message duck-message');
                    
                    // 添加消息内容
                    messageElement.textContent = message.content;
                    container.appendChild(messageElement);
                    
                    // 如果有图片，显示图片
                    if (message.image) {
                        setTimeout(() => {
                            const imageContainer = createElement('div');
                            imageContainer.style.cssText = `
                                margin: 10px 0;
                                max-width: 100%;
                                align-self: flex-start;
                            `;
                            
                            const image = document.createElement('img');
                            image.src = message.image;
                            image.style.cssText = `
                                max-width: 100%;
                                border-radius: 8px;
                                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                            `;
                            
                            imageContainer.appendChild(image);
                            container.appendChild(imageContainer);
                            container.scrollTop = container.scrollHeight;
                        }, 400);
                    }
                    
                    // 如果有选项，延迟显示选项卡
                    if (message.options) {
                        setTimeout(() => {
                            const optionsContainer = createElement('options-container');
                            optionsContainer.id = 'options-container';
                            
                            message.options.forEach((option, index) => {
                                const optionButton = createElement('option-button', option);
                                optionsContainer.appendChild(optionButton);
                            });
                            
                            container.appendChild(optionsContainer);
                            container.scrollTop = container.scrollHeight;
                            
                            // 延迟自动选中"高三"选项
                            setTimeout(() => {
                                const highSchoolOption = Array.from(optionsContainer.querySelectorAll('.option-button'))
                                    .find(button => button.textContent.trim() === '高三');
                                
                                if (highSchoolOption) {
                                    // 添加选中样式
                                    highSchoolOption.classList.add('selected');
                                    
                                    // 立即移除选项并显示用户消息，不再添加额外延迟
                                    optionsContainer.remove();
                                    
                                    // 显示用户选择的消息
                                    showUserMessage(message.content, message.image).then(() => {
                                        // 完成这条消息的处理
                                        resolve();
                                    });
                                } else {
                                    resolve(); // 如果找不到"高三"选项，直接完成
                                }
                            }, 1500);
                        }, 1500); // 显示AI消息后1.5秒显示选项
                    } else {
                        // 如果没有选项，创建其他内容并完成处理
                        
                        // 如果有表单，显示表单
                        if (message.form) {
                            const formContainer = createElement('form-container');
                            const formTitle = createElement('form-title', message.form.title);
                            formContainer.appendChild(formTitle);
                            
                            message.form.modules.forEach(module => {
                                const formGroup = createElement('form-group');
                                const groupTitle = createElement('form-group-title', module.title);
                                formGroup.appendChild(groupTitle);
                                
                                const formOptions = createElement('form-options');
                                module.options.forEach((option, index) => {
                                    const formOption = createElement('form-option', option);
                                    // 初始不选中任何选项
                                    formOptions.appendChild(formOption);
                                });
                                
                                formGroup.appendChild(formOptions);
                                formContainer.appendChild(formGroup);
                            });
                            
                            const formSubmit = createElement('form-submit', '提交');
                            formSubmit.style.opacity = '0.5';  // 初始提交按钮设为半透明
                            formSubmit.style.pointerEvents = 'none';  // 禁用点击
                            formContainer.appendChild(formSubmit);
                            container.appendChild(formContainer);
                            
                            // 添加指示器提示正在自动填写
                            const autoFillIndicator = createElement('div', '鸭鸭正在帮你填写...');
                            autoFillIndicator.style.cssText = `
                                align-self: flex-start;
                                font-size: 12px;
                                color: #888;
                                margin: 5px 15px;
                                opacity: 0.7;
                            `;
                            container.appendChild(autoFillIndicator);
                            container.scrollTop = container.scrollHeight;
                            
                            // 自动选择表单选项和提交
                            setTimeout(() => {
                                autoSelectFormOptions(formContainer, message.form, () => {
                                    // 移除指示器
                                    autoFillIndicator.remove();
                                    
                                    // 启用并高亮提交按钮
                                    formSubmit.style.opacity = '1';
                                    formSubmit.style.pointerEvents = 'auto';
                                    
                                    // 添加提交指示器
                                    const submitIndicator = createElement('div', '鸭鸭正在提交...');
                                    submitIndicator.style.cssText = `
                                        align-self: flex-start;
                                        font-size: 12px;
                                        color: #888;
                                        margin: 5px 15px;
                                        opacity: 0.7;
                                    `;
                                    container.appendChild(submitIndicator);
                                    container.scrollTop = container.scrollHeight;
                                    
                                    // 自动点击提交按钮
                                    setTimeout(() => {
                                        formSubmit.classList.add('clicked');
                                        setTimeout(() => {
                                            // 修改按钮文本为"已提交"
                                            formSubmit.innerHTML = '已提交';
                                            // 添加样式使按钮置灰
                                            formSubmit.style.backgroundColor = '#a9a9a9';
                                            formSubmit.style.pointerEvents = 'none';
                                            formSubmit.style.cursor = 'default';
                                            formSubmit.style.boxShadow = 'none';
                                            
                                            formSubmit.classList.remove('clicked');
                                            submitIndicator.remove();
                                            resolve();
                                        }, 500);
                                    }, 1000);
                                });
                            }, 1500);
                        } else {
                            // 其他内容处理保持不变
                            // ... 现有代码 ...
                            
                            container.scrollTop = container.scrollHeight;
                            resolve();
                        }
                    }
                }, 300);
            });
        }

        // 添加自动选择表单选项的函数
        function autoSelectFormOptions(formContainer, formData, callback) {
            const formGroups = formContainer.querySelectorAll('.form-group');
            
            // 依次选择每个模块的选项
            function selectNextGroup(index) {
                if (index >= formGroups.length) {
                    // 所有模块选择完成
                    if (callback) callback();
                    return;
                }
                
                const group = formGroups[index];
                const options = group.querySelectorAll('.form-option');
                const selectedIndex = formData.modules[index].selected;
                
                // 添加鼠标悬停效果
                setTimeout(() => {
                    options[selectedIndex].classList.add('hover-effect');
                    
                    // 添加点击效果
                    setTimeout(() => {
                        options[selectedIndex].classList.remove('hover-effect');
                        options[selectedIndex].classList.add('selected');
                        
                        // 播放点击声音（可选）
                        // playClickSound();
                        
                        // 继续下一个组
                        selectNextGroup(index + 1);
                    }, 400);
                }, 800);
            }
            
            // 开始选择第一个组
            selectNextGroup(0);
        }

        // 显示用户消息
        async function showUserMessage(content, image) {
            return new Promise(resolve => {
                setTimeout(() => {
                    const container = document.getElementById('chat-messages-container');
                    const messageElement = createElement('message user-message', content);
                    container.appendChild(messageElement);
                    
                    // 如果有图片，显示图片
                    if (image) {
                        setTimeout(() => {
                            const imageContainer = createElement('div');
                            imageContainer.style.cssText = `
                                margin: 10px 0;
                                max-width: 100%;
                                align-self: flex-end;
                            `;
                            
                            const imageElement = document.createElement('img');
                            imageElement.src = image;
                            imageElement.style.cssText = `
                                max-width: 100%;
                                border-radius: 8px;
                                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                            `;
                            
                            imageContainer.appendChild(imageElement);
                            container.appendChild(imageContainer);
                            container.scrollTop = container.scrollHeight;
                        }, 400);
                    }
                    
                    container.scrollTop = container.scrollHeight;
                    resolve();
                }, 1000);
            });
        }

        // 灵动岛眨眼动画
        function startBlinking() {
            const leftEye = document.getElementById('left-eye');
            const rightEye = document.getElementById('right-eye');
            
            setInterval(() => {
                leftEye.classList.add('blink');
                rightEye.classList.add('blink');
                
                setTimeout(() => {
                    leftEye.classList.remove('blink');
                    rightEye.classList.remove('blink');
                }, 300);
            }, 4000);
        }

        // 显示思考灵动岛
        async function showThinking(message) {
            return new Promise(resolve => {
                const dynamicIsland = document.getElementById('dynamic-island');
                const eyeContainer = document.getElementById('eye-container');
                const thinkingText = document.getElementById('thinking-text');
                const thinkIcon = document.getElementById('think-icon');
                const analysisText = document.getElementById('analysis-text');
                const findIcon = document.getElementById('find-icon');
                const extraLine1 = document.getElementById('extra-line1');
                const extraLine2 = document.getElementById('extra-line2');
                
                // 初始化灵动岛状态
                eyeContainer.classList.remove('fade-out', 'hidden');
                thinkingText.classList.remove('visible');
                thinkIcon.classList.remove('visible');
                analysisText.classList.remove('visible');
                findIcon.classList.remove('visible');
                extraLine1.classList.remove('visible');
                extraLine2.classList.remove('visible');
                
                // 重置文本内容
                analysisText.textContent = '';
                extraLine1.textContent = '';
                extraLine2.textContent = '';
                
                // 重置thinking-text，清除旧的计时器
                thinkingText.textContent = '思考中';
                const existingTimer = document.getElementById('timer-span');
                if (existingTimer) {
                    existingTimer.remove();
                }
                
                // 确保动态岛处于初始状态
                dynamicIsland.className = 'dynamic-island';
                dynamicIsland.style.minHeight = '';
                
                // 预先估算文本高度 - 在任何动画开始前
                const isLongText = message.analysis.length > 150;
                
                // 使用requestAnimationFrame确保样式变化在合适的时机执行
                requestAnimationFrame(() => {
                    // 步骤1：灵动岛眼睛逐渐消失
                    eyeContainer.classList.add('fade-out');
                    
                    setTimeout(() => {
                        eyeContainer.classList.add('hidden');
                        
                        // 准备计时器元素
                        const timerSpan = document.createElement('span');
                        timerSpan.style.marginLeft = '6px';
                        timerSpan.id = 'timer-span';
                        thinkingText.appendChild(timerSpan);
                        
                        // 在后台精确计算分析文本的高度
                        const tempDiv = document.createElement('div');
                        tempDiv.style.cssText = `
                            position: absolute; 
                            visibility: hidden; 
                            width: 276px;
                            font-size: 14px;
                            line-height: 20px;
                            letter-spacing: 0.1em;
                            font-family: 'PingFang SC', sans-serif;
                        `;
                        tempDiv.textContent = message.analysis;
                        document.body.appendChild(tempDiv);
                        
                        const analysisHeight = tempDiv.clientHeight;
                        document.body.removeChild(tempDiv);
                        
                        // 计算所有内容的总高度
                        const searchLines = message.searching.split('\n');
                        let totalHeight = 56 + analysisHeight + 40; // top位置 + 分析高度 + 边距
                        
                        if (searchLines.length > 0) {
                            totalHeight += 28; // 第一行搜索内容
                        }
                        
                        if (searchLines.length > 1) {
                            totalHeight += 38; // 第二行搜索内容
                        }
                        
                        totalHeight = Math.max(totalHeight, 282); // 确保至少达到基本高度
                        
                        // 一次性切换到expanded-step1
                        requestAnimationFrame(() => {
                            dynamicIsland.classList.add('expanded-step1');
                            
                            setTimeout(() => {
                                // 显示thinking-text和计时器
                                thinkingText.classList.add('visible');
                                
                                // 启动计时器
                                let seconds = 1;
                                const timerInterval = setInterval(() => {
                                    const min = Math.floor(seconds / 60);
                                    const sec = seconds % 60;
                                    timerSpan.textContent = `${min}:${sec.toString().padStart(2, '0')}`;
                                    seconds++;
                                }, 1000);
                                
                                setTimeout(() => {
                                    // 一次性切换到expanded-step2，对于长文本直接使用预计算的更大尺寸
                                    requestAnimationFrame(() => {
                                        dynamicIsland.classList.remove('expanded-step1');
                                        
                                        // 特殊处理长文本：直接使用足够大的高度
                                        if (isLongText) {
                                            // 设置一个足够大的高度，超过分析文本所需的高度
                                            dynamicIsland.style.minHeight = `${Math.max(totalHeight, 350)}px`;
                                            dynamicIsland.classList.add('expanded-step3');
                                        } else {
                                            dynamicIsland.classList.add('expanded-step2');
                                        }
                                        
                                        setTimeout(() => {
                                            // 显示思考图标
                                            thinkIcon.classList.add('visible');
                                            
                                            setTimeout(() => {
                                                // 显示分析文本 - 此时容器已经足够大
                                                typeText(analysisText, message.analysis, () => {
                                                    // 分析文本完成后
                                                    setTimeout(() => {
                                                        if (!isLongText) {
                                                            // 只有在非长文本时才需要这个过渡
                                                            requestAnimationFrame(() => {
                                                                dynamicIsland.style.minHeight = `${totalHeight}px`;
                                                                dynamicIsland.classList.remove('expanded-step2');
                                                                dynamicIsland.classList.add('expanded-step3');
                                                            });
                                                        }
                                                        
                                                        // 设置搜索图标和内容的位置
                                                        const currentAnalysisBottom = 56 + analysisHeight;
                                                        findIcon.style.top = (currentAnalysisBottom + 20) + 'px';
                                                        extraLine1.style.left = '45px';
                                                        extraLine1.style.right = '29px';
                                                        extraLine1.style.top = (currentAnalysisBottom + 15) + 'px';
                                                        
                                                        if (searchLines.length > 1) {
                                                            extraLine2.style.left = '45px';
                                                            extraLine2.style.right = '29px';
                                                            extraLine2.style.top = (currentAnalysisBottom + 15 + 28 + 10) + 'px';
                                                        }
                                                        
                                                        setTimeout(() => {
                                                            // 显示搜索图标和内容
                                                            findIcon.classList.add('visible');
                                                            
                                                            if (searchLines.length > 0) {
                                                                extraLine1.classList.add('visible');
                                                                typeText(extraLine1, searchLines[0]);
                                                            }
                                                            
                                                            if (searchLines.length > 1) {
                                                                setTimeout(() => {
                                                                    extraLine2.classList.add('visible');
                                                                    typeText(extraLine2, searchLines[1]);
                                                                }, 400);
                                                            }
                                                            
                                                            // 3秒后收回灵动岛
                                                            setTimeout(() => {
                                                                clearInterval(timerInterval);
                                                                
                                                                // 一次性隐藏所有内容
                                                                thinkingText.classList.remove('visible');
                                                                thinkIcon.classList.remove('visible');
                                                                analysisText.classList.remove('visible');
                                                                findIcon.classList.remove('visible');
                                                                extraLine1.classList.remove('visible');
                                                                extraLine2.classList.remove('visible');
                                                                
                                                                // 在下一帧恢复初始状态
                                                                requestAnimationFrame(() => {
                                                                    dynamicIsland.style.minHeight = '';
                                                                    dynamicIsland.className = 'dynamic-island';
                                                                    
                                                                    setTimeout(() => {
                                                                        eyeContainer.classList.remove('hidden');
                                                                        eyeContainer.classList.remove('fade-out');
                                                                        resolve();
                                                                    }, 300);
                                                                });
                                                            }, 1500);
                                                        }, 400);
                                                    }, 800);
                                                });
                                            }, 400);
                                        }, 400);
                                    });
                                }, 400);
                            }, 400);
                        }, 400);
                    }, 400);
                });
            });
        }

        // 文本打字机效果
        function typeText(element, text, callback) {
            element.classList.add('visible');
            element.textContent = '';
            
            let index = 0;
            
            function typeChar() {
                if (index < text.length) {
                    element.textContent += text[index];
                    index++;
                    setTimeout(typeChar, 15);
                } else if (callback) {
                    callback(); // 文本完全显示后执行回调
                }
            }
            
            typeChar();
        }

        // 显示计划卡片
        async function showPlanCard(message) {
            return new Promise(resolve => {
                setTimeout(() => {
                    const container = document.getElementById('chat-messages-container');
                    const cardContainer = createElement('card-container');
                    const cardTitle = createElement('card-title', message.title);
                    cardContainer.appendChild(cardTitle);
                    
                    const planCard = createElement('plan-card');
                    message.items.forEach(item => {
                        const planItem = createElement('plan-item');
                        const planIcon = createElement('plan-icon', item.icon);
                        const planInfo = createElement('plan-info');
                        
                        const planTitle = createElement('plan-title', item.title);
                        const planDuration = createElement('plan-duration', item.duration);
                        
                        planInfo.appendChild(planTitle);
                        planInfo.appendChild(planDuration);
                        
                        planItem.appendChild(planIcon);
                        planItem.appendChild(planInfo);
                        
                        planCard.appendChild(planItem);
                    });
                    
                    // 添加按钮
                    const planButtons = createElement('plan-buttons');
                    const adjustButton = createElement('plan-button plan-button-adjust', '需要调整');
                    const addButton = createElement('plan-button plan-button-add', '添加计划');
                    
                    // 添加点击事件
                    addButton.addEventListener('click', () => {
                        showSuccessDialog();
                    });
                    
                    planButtons.appendChild(adjustButton);
                    planButtons.appendChild(addButton);
                    
                    planCard.appendChild(planButtons);
                    cardContainer.appendChild(planCard);
                    container.appendChild(cardContainer);
                    
                    container.scrollTop = container.scrollHeight;
                    resolve();
                }, 500);
            });
        }
        
        // 显示成功弹窗
        function showSuccessDialog() {
            const successDialog = document.createElement('div');
            successDialog.className = 'success-dialog';
            successDialog.style.display = 'block';
            
            const successMessage = createElement('success-message', '已添加任务');
            const successButton = createElement('success-button', '开始学习');
            
            successDialog.appendChild(successMessage);
            successDialog.appendChild(successButton);
            
            document.body.appendChild(successDialog);
            
            successButton.addEventListener('click', () => {
                successDialog.style.display = 'none';
                setTimeout(() => {
                    document.body.removeChild(successDialog);
                }, 300);
            });
            
            setTimeout(() => {
                successDialog.style.display = 'none';
                setTimeout(() => {
                    document.body.removeChild(successDialog);
                }, 300);
            }, 2000);
        }

        // 渲染整个对话
        async function renderConversation() {
            startBlinking(); // 开始眨眼动画
            
            for (let i = 0; i < conversation.length; i++) {
                const message = conversation[i];
                
                if (message.type === 'thinking') {
                    await showThinking(message);
                } else if (message.type === 'ai') {
                    await showAiMessage(message);
                    
                    // 跳过第一条用户消息（已由选项自动生成）
                    if (i === 0 && i + 1 < conversation.length && conversation[i + 1].type === 'user') {
                        i++; // 跳过下一条预定义的用户消息
                    } 
                    // 检查下一条消息是否也是AI发送的，如果是，添加延迟
                    else if (i + 1 < conversation.length && conversation[i + 1].type === 'ai') {
                        // AI连续发送消息时的延迟（1.5-2.5秒）
                        const aiThinkingDelay = Math.floor(Math.random() * 500) + 800;
                        await new Promise(resolve => setTimeout(resolve, aiThinkingDelay));
                        
                        // 添加"鸭鸭正在输入..."的提示
                        const container = document.getElementById('chat-messages-container');
                        const typingIndicator = createElement('div', '鸭鸭正在输入...');
                        typingIndicator.style.cssText = `
                            align-self: flex-start;
                            font-size: 12px;
                            color: #888;
                            margin: 5px 15px;
                            opacity: 0.7;
                        `;
                        container.appendChild(typingIndicator);
                        container.scrollTop = container.scrollHeight;
                        
                        // 显示输入状态0.8-1.5秒
                        const typingTime = Math.floor(Math.random() * 700) + 800;
                        await new Promise(resolve => setTimeout(resolve, typingTime));
                        typingIndicator.remove();
                    }
                    
                    // 添加额外延迟，模拟用户思考时间
                    if (i + 1 < conversation.length && conversation[i + 1].type === 'user') {
                        await new Promise(resolve => setTimeout(resolve, 500)); // 用户思考的时间
                    }
                } else if (message.type === 'user') {
                    // 模拟用户输入
                    await simulateTyping();
                    await showUserMessage(message.content, message.image);
                } else if (message.type === 'plan') {
                    await showPlanCard(message);
                }
            }
        }
        
        // 添加模拟输入状态的函数
        async function simulateTyping() {
            return new Promise(resolve => {
                // 这里可以添加"正在输入"的指示器
                // 简单实现：可以在消息容器下方添加一个临时的"正在输入..."提示
                const container = document.getElementById('chat-messages-container');
                const typingIndicator = createElement('div', '正在输入...');
                typingIndicator.style.cssText = `
                    align-self: flex-end;
                    font-size: 12px;
                    color: #888;
                    margin: 5px 15px;
                    opacity: 0.7;
                `;
                container.appendChild(typingIndicator);
                container.scrollTop = container.scrollHeight;
                
                // 随机时间后移除"正在输入"指示器，模拟真实输入体验
                const typingTime = Math.floor(Math.random() * 1000) + 500; // 从1-3秒改为0.5-1.5秒
                setTimeout(() => {
                    typingIndicator.remove();
                    resolve();
                }, typingTime);
            });
        }
        
        // 表单选项点击效果
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('form-option')) {
                const parent = event.target.parentElement;
                parent.querySelectorAll('.form-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                event.target.classList.add('selected');
            }
            
            if (event.target.classList.contains('option-button')) {
                const parent = event.target.parentElement;
                parent.querySelectorAll('.option-button').forEach(opt => {
                    opt.classList.remove('selected');
                });
                event.target.classList.add('selected');
            }
        });
        
        // 页面加载完成后开始渲染对话
        window.addEventListener('load', renderConversation);
    </script>
</body>
</html>